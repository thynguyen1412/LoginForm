<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>To-Do List - Christmas Theme</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-green-50 min-h-screen flex flex-col justify-between">
    <!-- Header -->
    <header class="bg-red-600 text-white py-4 shadow-md">
      <div class="container mx-auto text-center">
        <h1 class="text-4xl font-bold">üéÑ C√ÅC C√îNG VI·ªÜC C·∫¶N L√ÄM üéÖ</h1>
        <p class="mt-2 text-lg">L√™n k·∫ø ho·∫°ch cho m·ªôt Gi√°ng Sinh th·∫≠t vui v·∫ª!</p>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow">
      <div class="container mx-auto p-6">
        <form
          id="task-form"
          class="flex flex-wrap gap-4 justify-center items-center"
        >
          <input
            id="task-input"
            type="text"
            placeholder="Th√™m c√¥ng vi·ªác..."
            class="flex-grow p-3 border rounded border-green-500 placeholder-green-400 focus:ring-2 focus:ring-green-500"
          />
          <select
            id="task-category"
            class="p-3 border rounded border-red-500 bg-red-50"
          >
            <option value="English">Ti·∫øng Anh</option>
            <option value="Coding">L·∫≠p tr√¨nh</option>
          </select>
          <button
            type="submit"
            class="bg-red-500 text-white px-4 py-3 rounded hover:bg-red-600 transition-all"
          >
            Th√™m
          </button>
        </form>

        <div
          id="tasks-container"
          class="mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
        >
          <!-- Hi·ªÉn th·ªã danh s√°ch c√¥ng vi·ªác -->
        </div>

        <!-- Close Button -->
        <div class="mt-10 text-center">
          <button
            id="close-button"
            class="bg-red-500 text-white px-6 py-3 rounded hover:bg-red-600 transition-all"
          >
            ƒê√≥ng Trang
          </button>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-red-600 text-white py-4">
      <div class="container mx-auto text-center">
        <p class="text-sm">
          Ch√∫c b·∫°n c√≥ m·ªôt Gi√°ng Sinh an l√†nh v√† h·∫°nh ph√∫c! üéÑ
        </p>
      </div>
    </footer>

    <script>
      const API_URL = "https://675283dfd1983b9597b66bc1.mockapi.io/api/bai4"; // Thay b·∫±ng URL c·ªßa Mock API.

      // H√†m l·∫•y danh s√°ch c√¥ng vi·ªác t·ª´ Mock API
      async function fetchTasksFromAPI() {
        try {
          const response = await fetch(API_URL);
          if (!response.ok)
            throw new Error("L·ªói khi l·∫•y danh s√°ch c√¥ng vi·ªác t·ª´ API");
          return await response.json();
        } catch (error) {
          console.error("L·ªói:", error);
          alert("Kh√¥ng th·ªÉ t·∫£i danh s√°ch c√¥ng vi·ªác.");
          return [];
        }
      }

      // H√†m th√™m c√¥ng vi·ªác v√†o Mock API
      async function addTaskToAPI(task) {
        try {
          const response = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(task),
          });
          if (!response.ok) throw new Error("L·ªói khi th√™m c√¥ng vi·ªác v√†o API");
          return await response.json();
        } catch (error) {
          console.error("L·ªói:", error);
          alert("Kh√¥ng th·ªÉ th√™m c√¥ng vi·ªác v√†o API.");
        }
      }

      // H√†m c·∫≠p nh·∫≠t c√¥ng vi·ªác l√™n Mock API
      async function updateTaskInAPI(taskId, updates) {
        try {
          const response = await fetch(`${API_URL}/${taskId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(updates),
          });
          if (!response.ok)
            throw new Error("L·ªói khi c·∫≠p nh·∫≠t c√¥ng vi·ªác l√™n API");
          return await response.json();
        } catch (error) {
          console.error("L·ªói:", error);
          alert("Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t c√¥ng vi·ªác l√™n API.");
        }
      }

      // H√†m x√≥a c√¥ng vi·ªác t·ª´ Mock API
      async function deleteTaskFromAPI(taskId) {
        try {
          const response = await fetch(`${API_URL}/${taskId}`, {
            method: "DELETE",
          });
          if (!response.ok) throw new Error("L·ªói khi x√≥a c√¥ng vi·ªác t·ª´ API");
        } catch (error) {
          console.error("L·ªói:", error);
          alert("Kh√¥ng th·ªÉ x√≥a c√¥ng vi·ªác t·ª´ API.");
        }
      }

      // H√†m hi·ªÉn th·ªã c√¥ng vi·ªác trong giao di·ªán
      function renderTask(task) {
        const taskElement = document.createElement("div");
        taskElement.className =
          "p-4 border rounded shadow bg-white flex flex-col gap-2";

        taskElement.innerHTML = `
          <h3 class="text-lg font-semibold">${task.text}</h3>
          <p class="text-sm text-red-500">Ch·ªß ƒë·ªÅ: ${task.category}</p>
          <select class="status-dropdown p-2 border rounded">
            <option value="Not Started" ${
              task.status === "Not Started" ? "selected" : ""
            }>Ch∆∞a ho√†n th√†nh</option>
            <option value="In Progress" ${
              task.status === "In Progress" ? "selected" : ""
            }>ƒêang ho√†n th√†nh</option>
            <option value="Completed" ${
              task.status === "Completed" ? "selected" : ""
            }>ƒê√£ ho√†n th√†nh</option>
          </select>
          <div class="flex gap-2">
            <button class="text-sm text-blue-600 hover:underline edit-task">Ch·ªânh s·ª≠a</button>
            <button class="text-sm text-red-600 hover:underline remove-task">X√≥a</button>
          </div>
        `;

        // S·ª± ki·ªán thay ƒë·ªïi tr·∫°ng th√°i
        taskElement
          .querySelector(".status-dropdown")
          .addEventListener("change", async (e) => {
            const newStatus = e.target.value;
            try {
              await updateTaskInAPI(task.id, { status: newStatus });
              alert("Tr·∫°ng th√°i ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!");
            } catch (error) {
              console.error("L·ªói:", error);
              alert("Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i.");
            }
          });

        // S·ª± ki·ªán ch·ªânh s·ª≠a c√¥ng vi·ªác
        taskElement
          .querySelector(".edit-task")
          .addEventListener("click", async () => {
            const newText = prompt("Nh·∫≠p l·∫°i c√¥ng vi·ªác:", task.text);
            const newCategory = prompt(
              "Ch·ªçn l·∫°i ch·ªß ƒë·ªÅ (English, Coding):",
              task.category
            );
            if (!newText || !newCategory) return;

            try {
              const updatedTask = await updateTaskInAPI(task.id, {
                text: newText,
                category: newCategory,
              });
              task.text = updatedTask.text;
              task.category = updatedTask.category;
              taskElement.querySelector("h3").textContent = updatedTask.text;
              taskElement.querySelector(
                "p"
              ).textContent = `Ch·ªß ƒë·ªÅ: ${updatedTask.category}`;
              alert("C√¥ng vi·ªác ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!");
            } catch (error) {
              console.error("L·ªói:", error);
              alert("Kh√¥ng th·ªÉ ch·ªânh s·ª≠a c√¥ng vi·ªác.");
            }
          });

        // S·ª± ki·ªán x√≥a c√¥ng vi·ªác
        taskElement
          .querySelector(".remove-task")
          .addEventListener("click", async () => {
            const confirmDelete = confirm(
              "B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a c√¥ng vi·ªác n√†y?"
            );
            if (!confirmDelete) return;
            await deleteTaskFromAPI(task.id);
            taskElement.remove();
          });

        // Th√™m ph·∫ßn t·ª≠ v√†o danh s√°ch c√¥ng vi·ªác
        document.getElementById("tasks-container").appendChild(taskElement);
      }

      // H√†m kh·ªüi t·∫°o danh s√°ch c√¥ng vi·ªác
      async function initializeTasks() {
        const tasks = await fetchTasksFromAPI();
        tasks.forEach(renderTask);
      }

      // X·ª≠ l√Ω s·ª± ki·ªán th√™m c√¥ng vi·ªác
      document
        .getElementById("task-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const taskInput = document.getElementById("task-input");
          const taskCategory = document.getElementById("task-category");

          const taskText = taskInput.value.trim();
          const taskCat = taskCategory.value;

          if (!taskText) {
            alert("Vui l√≤ng nh·∫≠p c√¥ng vi·ªác.");
            return;
          }

          const newTask = {
            text: taskText,
            category: taskCat,
            status: "Not Started",
          };
          const savedTask = await addTaskToAPI(newTask);
          if (!savedTask) return;

          renderTask(savedTask);
          taskInput.value = "";
          taskInput.focus();
        });

      // N√∫t ƒë√≥ng trang
      document.getElementById("close-button").addEventListener("click", () => {
        window.close();
      });

      // Kh·ªüi ch·∫°y khi t·∫£i trang
      initializeTasks();
    </script>
  </body>
</html>
